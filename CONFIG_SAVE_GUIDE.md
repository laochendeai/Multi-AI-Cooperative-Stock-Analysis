# 💾 TradingAgents 配置保存功能指南

## 🎉 新功能概述

TradingAgents现在支持**持久化配置保存**功能！您再也不需要每次启动程序都重新输入API密钥了。

## 🌐 访问系统

**增强版系统地址**: http://localhost:7864

## 💾 配置保存功能

### 1. **单个提供商保存**

每个LLM提供商都有独立的保存按钮：

#### 🔥 DeepSeek
1. 输入API密钥：`sk-xxxxxxxxxxxxxxxx`
2. 点击 **"💾 保存"** 按钮
3. 系统显示保存状态

#### 🧠 OpenAI
1. 输入API密钥：`sk-xxxxxxxxxxxxxxxx`
2. 点击 **"💾 保存"** 按钮
3. 配置立即保存到本地

#### 🌐 Google & 🌙 Moonshot
- 同样的操作流程
- 独立保存，互不影响

### 2. **批量配置管理** ⭐

在"内置提供商"标签页底部，新增了强大的批量操作功能：

#### 💾 保存所有配置
- **功能**: 一键保存当前所有已配置的LLM提供商
- **按钮**: "💾 保存所有配置"
- **用途**: 批量保存多个提供商的API密钥

#### 📂 重新加载配置
- **功能**: 从保存的配置文件重新加载所有设置
- **按钮**: "📂 重新加载配置"
- **用途**: 恢复之前保存的配置状态

#### 🗑️ 清空配置
- **功能**: 清空所有保存的配置，恢复到初始状态
- **按钮**: "🗑️ 清空配置"
- **用途**: 重置所有配置，重新开始

### 3. **自定义提供商保存**

自定义添加的LLM提供商也会自动保存：

1. **添加自定义提供商**时自动保存
2. **删除自定义提供商**时自动更新配置
3. **重启程序**后自动恢复所有自定义提供商

## 🔒 配置安全性

### 加密存储
- ✅ **API密钥加密**: 使用Base64编码存储，不是明文
- ✅ **本地存储**: 配置文件保存在本地 `config/llm_config.json`
- ✅ **安全显示**: 界面中显示为 `●●●●●●●●●●●●`

### 配置文件位置
```
项目根目录/
├── config/
│   └── llm_config.json  # 配置保存文件
├── app_enhanced.py
└── ...
```

### 配置文件格式
```json
{
  "llm_config": {
    "deepseek": "encrypted_api_key",
    "openai": "encrypted_api_key"
  },
  "custom_llm_providers": {
    "Claude": {
      "api_key": "encrypted_api_key",
      "base_url": "https://api.anthropic.com/v1",
      "model": "claude-3-sonnet",
      "added_time": "2024-01-01T10:00:00"
    }
  },
  "saved_time": "2024-01-01T10:00:00",
  "version": "1.0"
}
```

## 🚀 使用流程

### 首次配置
1. **启动系统**: 访问 http://localhost:7864
2. **配置LLM**: 在"⚙️ LLM配置"页面输入API密钥
3. **保存配置**: 点击各个"💾 保存"按钮
4. **验证保存**: 查看操作状态确认保存成功

### 日常使用
1. **启动系统**: 配置自动加载，无需重新输入
2. **直接使用**: 所有已保存的LLM提供商立即可用
3. **更新配置**: 需要时修改API密钥并重新保存

### 配置管理
1. **查看状态**: 在"操作状态"中查看当前配置数量
2. **重新加载**: 如有问题可重新加载配置
3. **清空重置**: 需要时可清空所有配置重新开始

## 📊 状态监控

### 操作状态显示
- **保存成功**: "配置已保存 (X个内置提供商, Y个自定义提供商)"
- **加载成功**: "配置已加载 (保存时间: YYYY-MM-DD HH:MM:SS)"
- **清空成功**: "配置已清空，重新加载环境变量配置"

### 系统启动信息
- **有配置**: 自动加载，显示加载的提供商数量
- **无配置**: "配置文件不存在，使用默认配置"

## 🔧 高级功能

### 环境变量优先级
1. **保存的配置** > **环境变量**
2. 启动时先加载保存的配置
3. 然后补充环境变量中的配置
4. 界面操作会覆盖所有配置

### 配置备份建议
```bash
# 备份配置文件
cp config/llm_config.json config/llm_config_backup.json

# 恢复配置文件
cp config/llm_config_backup.json config/llm_config.json
```

### 多环境配置
- **开发环境**: 使用测试API密钥
- **生产环境**: 使用正式API密钥
- **团队共享**: 可以共享配置文件模板（去除敏感信息）

## ⚠️ 注意事项

### 安全提醒
- 🔒 **保护配置文件**: 不要将包含API密钥的配置文件上传到公共仓库
- 🚫 **定期更换**: 定期更换API密钥确保安全
- 👥 **团队使用**: 每个团队成员使用自己的API密钥

### 使用建议
- 💾 **及时保存**: 配置API密钥后立即保存
- 🔄 **定期备份**: 重要配置建议手动备份
- 🧪 **测试验证**: 保存后测试连接确保配置正确

### 故障排除
- **配置丢失**: 使用"📂 重新加载配置"
- **配置错误**: 使用"🗑️ 清空配置"重新开始
- **文件损坏**: 删除 `config/llm_config.json` 重新配置

## 🎯 最佳实践

### 推荐工作流程
1. **首次设置**:
   ```
   输入API密钥 → 测试连接 → 保存配置 → 验证状态
   ```

2. **日常使用**:
   ```
   启动系统 → 自动加载配置 → 直接使用分析功能
   ```

3. **配置更新**:
   ```
   修改API密钥 → 测试连接 → 保存配置 → 确认更新
   ```

### 团队协作
- **配置模板**: 创建不含敏感信息的配置模板
- **文档说明**: 为团队成员提供配置指南
- **权限管理**: 确保配置文件的访问权限

## 🆘 常见问题

**Q: 配置保存在哪里？**
A: 保存在项目根目录的 `config/llm_config.json` 文件中

**Q: 配置是否加密？**
A: 是的，API密钥使用Base64编码存储，不是明文

**Q: 重启后配置会丢失吗？**
A: 不会，配置会自动加载，包括自定义提供商

**Q: 如何备份配置？**
A: 复制 `config/llm_config.json` 文件即可

**Q: 配置文件损坏怎么办？**
A: 删除配置文件，重新配置并保存

**Q: 可以同时使用环境变量和保存的配置吗？**
A: 可以，保存的配置优先级更高

---

**🎉 现在您可以一次配置，永久使用！再也不用每次启动都重新输入API密钥了！**

*TradingAgents Enhanced v1.0 | 智能配置管理，让使用更便捷*
